<h1 class="text-center mb-4">Liste des produits</h1>
<p-toast position="top-right"></p-toast>

<!-- Barre de filtre et bouton admin -->
<div class="flex justify-content-between align-items-center mb-3">
  <p-dropdown
    [options]="categories"
    [ngModel]="selectedCategory()"
    (ngModelChange)="selectedCategory.set($event)"
    placeholder="Filtrer par catégorie"
    styleClass="w-15rem"
  ></p-dropdown>

  <p-button
    *ngIf="isAdmin()"
    label="Créer produit"
    icon="pi pi-plus"
    (onClick)="onCreate()"
    class="p-button-success"
  ></p-button>
</div>

<!-- Liste des produits -->
<p-dataView [value]="paginatedProducts()" [trackBy]="trackById" layout="list">
  <ng-template pTemplate="list" let-products>
    <div *ngFor="let product of products; trackBy: trackById">
      <p-card class="mb-3 shadow-sm">
        <div class="flex justify-content-between align-items-center">
          <!-- Infos produit -->
          <div class="w-9">
            <h3 class="text-lg font-semibold">{{ product.name }}</h3>
            <p class="text-sm text-gray-600 mb-1">{{ product.description }}</p>
            <p class="text-green-700 font-semibold">{{ product.price | currency:'EUR' }}</p>
          </div>

          <!-- Actions -->
          <div class="flex flex-column align-items-end gap-2">
            <p-inputNumber 
            [(ngModel)]="product.quantity" 
            [min]="1" 
            mode="decimal"
            [ngStyle]="{ width: '10px !important' }">
            </p-inputNumber>

            <p-button 
              label="Ajouter au panier" 
              icon="pi pi-shopping-cart" 
              severity="success"
              (onClick)="addToCart(product, product.quantity)"
              [disabled]="!product.quantity || product.quantity <= 0">
            </p-button>

            <!-- Nouveau bouton wishlist -->
            <p-button
              label="Ajouter à la liste d'envie"
              icon="pi pi-heart"
              severity="help"
              (onClick)="addToWishlist(product.id)">
            </p-button>

            <div *ngIf="isAdmin()" class="flex gap-2">
              <p-button label="Modifier" severity="secondary" (onClick)="onUpdate(product)"></p-button>
              <p-button label="Supprimer" severity="danger" (onClick)="onDelete(product)"></p-button>
            </div>
          </div>
        </div>
      </p-card>
    </div>
  </ng-template>
</p-dataView>

<!-- Pagination -->
<p-paginator 
  [rows]="rows()" 
  [totalRecords]="filteredProducts().length" 
  [first]="first()" 
  (onPageChange)="onPageChange($event)">
</p-paginator>

<!-- Dialog création/édition produit -->
<p-dialog 
  [(visible)]="isDialogVisible" 
  [style]="{ width: '50vw' }" 
  [modal]="true" 
  header="Ajout / Édition produit">
  
  <app-product-form
    [product]="editedProduct()"
    (save)="onSave($event)"
    (cancel)="onCancel()">
  </app-product-form>
</p-dialog>
